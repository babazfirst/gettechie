---
title: Services
sidebar_position: 6
sidebar_label: 4 - Services
---

<!-- Imports -->

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Learn

### What is a service?

A **service** is the part of your application that handles all the business loggic. Services are, essentially, the meat of your applications. In Spring Boot, we use the `@service` annotation to tell Spring that our class is a service. 

The methods in your servvices are primarily called from the controller, but services in the smae applciation are also free to communicate with one another (remember, in the RESTful API world, different applciation can _only_ communicate with each otehr through their APIs). In this exercise, we will only be implementing one service, but there's no limit on the number of services you can include. Additionally, our service is going to be rather simple, but in practice, your services will be much larger and more complex.

### What is Mockito and what do we use it for? 

[Mockito](https://site.mockito.org/) is a mocking framework for our unit tests. **Mockito** is the process of faking or simulating classes. But why would we do that? Let's look at an example. 

Say we wanted to write some tests for a controller to make sure that, from the perspective of a client application, our calls return the right information (we did this in [Exercise 5](./controllers#3-write-tests)). The client application doesn't care how the information is procure, only that it can make a call to an endpoint and get the right information back. The server-side application is a "black box". So, in our unit tests, we want to emulate that. We don't care how the information about our snacks in gathered, but we know what it should look like. You will be addding a service to your application in this exercise that is responsible for retriving the information about the `Snack`. Back for the purposes of testing the controller, we don't need to know how the service does this. This is where mocking comes into play. 

We don't need our controller tests to make calls to an actual instance of our service class, so we simulate one instead. We use the `@MockBean` annotation to denote an object refrence as a mock. For instance, this line lets us pretend that we have an instance of `SnackService`:

```java
@MockBean 
private SnackService snackService;
```

Now, let's look at an example unit test:

```java title="SnackControllerTest.java"
@Test 
public void getSnackByIdTest() {
    Integer id = 1;
    String name = "Butterfingers";
    Snack snackToReturn = new Snack(id, name);

    // highlight-next-line
    Mockito.when(snackService.getSnackById(id));

    assertThat(snack.getId()).isEqualTo(id);
    assertThat(snack.getName()).isEqualTo(name);
}
```

First, look at the first three lines of the method. Here, we're creating a `Snack`. This is the information we want to have at the end of test.

Now take a look at the highlighted line. This where the magic happens. Let's break it down: 

- The `when()` method accepts a call to our mocked `SnackService` and returns when that call is made. 
- `theReturn()` simple returns the given object when it's called. 

This line reads like a sentence: "When this call is made, then return this object."

:::note
This technique is called **stubbing**, for those who are interested. We also use something called **partial mocking**, but the details aren't important here.
:::

In short, this line simple returns `snackToReturn` when we call `getSnackById(id)` in our mocked `SnackService`. But why is that useful? 

By mocking our `SnackService`, we have removed the need to worry about how `getSnackById()` works. `getSnackById()` could be an extremely long and complicated method, ut as long as we know what is _should_ return, we don't have to worry about changes in `getSnackById()` impacting our tests. All the controller cares about is that it makes a call to `getSnackById()` and get a `Snack` in return, so that's all we need to test. If a developer breaks `getSnackById()`, the tests for the controller don't have to be rewritten. 

In Summary, Mockito is a very useful, time-saving tool. It has a lot of functionality available-more than we can cover and more than we need in the bootcamp-but visit the [Mockito JavaDocs](https://javadoc.io/doc/org.mockito/mockito-core/latest/index.html) to learn more.


---

## Do 

### 1. Write `SnackService`

For now, we only need one method, `getSnackById()`, that returns a `Snack` object. 

In the `srcc/main/java/com/optum.<your project name>` directory, create a new pacjage called `service`.

In The newly created package, create a new Java class called `SnackService.java`. 

<Tabs
    groupId="SnackService"
    defaultValue="snippet"
    values={[
        {label: "Code Snippet", value: "snippet"},
        {label: "Full Code", value: "full"},
    ]}>
<TabItem value="snippet">

```java title="SnackService.java"
@Service
public class SnackService {
    public Snack getSnackById(Integer id) {
        ...
    }
}
```

</TabItem>

<TabItem value="full">

If copyiing the full file, you must change the package name (first line) to match your project name. 

```java title="SnackService.java"
package com.optum.bootcamp.service;

import org.springframework.stereotype.Service;

import com.optum.bootcamp.model.Snack;

@Service
public class SnackService {
    public Snack getSnackById(Integer id) {
        return new Snack(id, "Butterfingers");
    }
}
```

</TabItem>
</Tabs>


### 2. Update `SnackController`

We don't want our business logic in our controller-that violates the basic coding principle of **separation of concerns**-so we need to make call to our new service class.

Update the `SnackController.java` class in the `controller` package. 

Add the dependency to the `SnackService` using the `@Autowired` annotation. Update the `getSnackById()` method. 

<Tabs
    groupId="SnackController"
    defaultValue="snippet"
    values={[
        {label: "Code Snippet", value: "snippet"},
        {label: "Full Code", value: "full"},
    ]}>
<TabItem value="snippet">

```java title="SnackController.java"
@Autowired
private SnackService snackService;
    ... 
    public Snack getSnackById(@PathVariable("snackId") Integer id) {
        ...
    }
```

</TabItem>

<TabItem value="full">

If copyiing the full file, you must change the package name (first line) to match your project name. 

```java title="SnackService.java"
package com.optum.bootcamp.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

import com.optum.bootcamp.model.Snack;
import com.optum.bootcamp.service.SnackService;

@RestController
public class SnackController {

    @Autowired
    private SnackService snackService;

    @GetMapping(value = "/v1/snacks/{snackId}", produces = MediaType.APPLICAION_JSON_VALUE)
    public Snack getSnackById(@PathVariable("snackId") Integer id) {
        return snackService.getSnackById(id);
    }
}
```

</TabItem>
</Tabs>

### 3. Write tests 

Write a new unit test for the `getSnackById()` method we added in `SnackService`. Additionally, update the unit test for `SnackController` to utilize Mockito. 

#### SnackServiceTest 

In the `src/test/java/com.optum.<your project name>` directory, create a new package called `service`.

In the  newly created package, create a new Java class called `SnackServiceTest.java`.

<Tabs
    groupId="SnackServiceTest"
    defaultValue="snippet"
    values={[
        {label: 'Code Snippet', value: 'snippet'},
        {label: 'Full Code', value: 'full'},
    ]}>
<TabItem value="snippet">

```java titel="SnackServiceTest.java"
@SpringBootTest
public class SnackServiceTest {

    @Autowired
    private SnackService snackService;

    @Test 
    public void getSnackByIdTest() {
        ...
    }
}
```
</TabItem>

<TabItem value="full">

If copying the full file, you must change the package name (first line) to match your project name. 

```java title="SnackServiceTest.java"
package com.optum.bootcamp.servvice;

import static org.assertj.core.api.Assertions.assertThat;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import com.optum.bootcamp.model.Snack;

@SpringBootTest 
public class SnackServiceTest {

    @Autowired
    private SnackService snackService;

    @Test 
    public void getSnackByIdTest() {
        Integer id = 1;
        Snack snack = snackService.getSnackById(id);

        assertThat(snack.getId()).isEqualTo(id);
        assertThat(snack.getName()).isEqualTo("Butterfingers");
    }
}
```

</TabItem>
</Tabs>

#### SnackControllerTest

In the `src/test/java/com.optum.<your project name>/controller` package, update `SnackControllerTest.java` to mock the SnackService object. 

<Tabs 
    groupId="SnackControllerTest"
    defaultValue="snippet"
    values={[
        {label: 'Code Snippet', value: 'snippet'},
        {label: 'Full Code', value: 'full'},
    ]}>
<TabItem value="snippet">

```java titel="SnackControllerTest.java"
...
    @Autowired
    private SnackController SnackController;

    @MockBean
    private SnackService snackService;

    @Test 
    public void getSnackByIdTest() {
        ...
    }
}
```

</TabItem>

<TabItem value="full">

If copying the full file, you must change the package name (first line) to match your project name. 

```java titel="SnackControllerTest.java"
package com.optum.bootcamp.controller;

import static org.assertj.core.api.Assertions.assertThat;

import org.junit.jupiter.api.Test;
import org.mockito.Mockito;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

import com.optum.bootcamp.model.Snack;
import com.optum.bootcamp.service.SnackService;

@SpringBootTest
public class SnackControllerTest {

    @Autowired
    private SnackController snackController;

    @MockBean
    private SnackService snackService;

    @Test
    public void getSnackByIdTest() {
        Integer id  = 1;
        String name = "Butterfingers";
        Snack snackToReturn = new Snack(id, name);

        Mockito.when(snackService.getSnackById(id)).thenReturn(snackToReturn);

        Snack snack = snackController.getSnackById(id);

        assertThat(snack.get()).isEqualTo(id);
        assertThat(snack.getName()).isEqualTo(name);
    }
}
```

</TabItem>
</Tabs>

Run your tests as in [Controllers](./controllers#3-write-tests).

:::note
We don't need to changes our integration tests in this exercise because nothing about the exposed endpoint has changed; we're still returning a snack with the given ID. 
It would still be a good idea to [run those tests](./controllers#3-write-tests), however, just to be sure that our changes haven't caused any unintended behavior.
:::

### 4. Deploy to nonprod 

Deploy the application to nonprod following the same steps as in [Controllers](./controllers#4-commit-and-push-changes).

---
